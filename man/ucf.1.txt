UCF(1)                      Debian GNU/Linux manual                     UCF(1)



NNAAMMEE
       ucf  -  Update Configuration File:  preserve user changes in configura-
       tion files

SSYYNNOOPPSSIISS
       uuccff [_o_p_t_i_o_n_s] _<_N_e_w _F_i_l_e_> _<_D_e_s_t_i_n_a_t_i_o_n_>

       uuccff [_o_p_t_i_o_n_s] _-_-_p_u_r_g_e _<_D_e_s_t_i_n_a_t_i_o_n_>

DDEESSCCRRIIPPTTIIOONN
       This utility provides a means of asking the  user  whether  or  not  to
       accept  new  versions  of  configuration  files provided by the package
       maintainer, with various heuristics designed  to  minimize  interaction
       time.  It uses debconf to interact with the user, as per Debian policy.
       In the SYNOPSIS above, _N_e_w _f_i_l_e is the configuration file  as  provided
       by  the  package  (either shipped with the package, or generated by the
       maintainer scripts on the fly), and _D_e_s_t_i_n_a_t_i_o_n is the  location  (usu-
       ally under /etc) where the real configuration file lives, and is poten-
       tially modified by the end user.  As far as possible, ucf  attempts  to
       preserve  the  ownership and permission of the _N_e_w _f_i_l_e as it is copied
       to the new location.

       This script attempts  to  provide  conffile  like  handling  for  files
       installed  under  _/_e_t_c  not shipped in a DDeebbiiaann package, but handled by
       the postinst instead.  DDeebbiiaann policy states that files under _/_e_t_c which
       are configuration files mmuusstt preserve user changes, and this applies to
       files handled by maintainer scripts as well. Using uuccff,, one may ship  a
       bunch   of   default   configuration   files   somewhere   in   _/_u_s_r  (
       _/_u_s_r_/_s_h_a_r_e_/_<_p_k_g_> is a good location), and maintain files in _/_e_t_c_,  pre-
       serving  user changes and in general offering the same facilities while
       upgrading that ddppkkgg normally provides for _"_c_o_n_f_f_i_l_e_s_"

       Additionally, this script provides facilities for transitioning a  file
       that  had not been provided _c_o_n_f_f_i_l_e like protection to come under this
       schema, and attempts to  minimize  questions  asked  at  install  time.
       Indeed,  the  transitioning  facility is better than the one offered by
       ddppkkgg while transitioning a file from a _n_o_n_-_c_o_n_f_f_i_l_e to _c_o_n_f_f_i_l_e status.
       The  second form in the SYNOPSIS above is for purging information about
       the configuration file when the package is purged; and is critical  for
       allowing smooth reinstallations.

       During the course of operations, when working with configuration files,
       uuccff optionally creates copies of versions of the configuration file  in
       question.  For  example,  a  file with the suffix _u_c_f_-_o_l_d holds the old
       version of a configuration file replaced by uuccff..  Also, copies  of  the
       configuration  file  with the suffixes _u_c_f_-_n_e_w and _u_c_f_-_d_i_s_t may be cre-
       ated; and the maintainer scripts should consider purging copies of  the
       configuration file with these extensions during purge.

OOPPTTIIOONNSS
       --hh,, ----hheellpp
              Print a short usage message

       --nn,, ----nnoo--aaccttiioonn
              Dry  run. Print the actions that would be taken if the script is
              invoked, but take no action.

       --dd [[nn]],, ----ddeebbuugg [[nn]]
              Set the debug level to the (optional) level _n (n defaults to 1).
              This turns on copious debugging information.

       --pp,, ----ppuurrggee
              Removes  all  vestiges of the file from the state hashfile. This
              is required to allow a package to be  reinstalled  after  it  is
              purged; since otherwise, the real configuration file is removed,
              but it remains in the hash file; and on reinstall no  action  is
              taken,  since  the  md5sum  of  the new file matches that in the
              hashfile.  In short, remember to use this option in  the  postrm
              for  every configuration file managed by ucf when the package is
              being purged (assuming ucf itself exists).  _N_o_t_e_: ucf  does  not
              actually  touch  the file on disk in this operation, so any file
              removals are still the responsibility of the calling package.

       --vv,, ----vveerrbboossee
              Make the script be very verbose  about  setting  internal  vari-
              ables.

       --ss ffoooo,, ----ssrrcc--ddiirr  ffoooo
              Set  the  source  directory  (historical md5sums are expected to
              live in files and sub directories of this directory) to foo.  By
              default,  the  directory  the new_file lives in is assumed to be
              the source directory. Setting this option overrides settings  in
              the  environment variable UUCCFF__SSOOUURRCCEE__DDIIRR,, and in the  configura-
              tion  file variable ccoonnff__ssoouurrccee__ddiirr..

       ----ssuumm--ffiillee  ffoooo
              Force the historical md5sums to be read from this  file,  rather
              than defaulting to living in the source directory.  Setting this
              option  overrides   settings   in   the   environment   variable
              UUCCFF__OOLLDD__MMDDSSUUMM__FFIILLEE,,  and  in  the   configuration  file variable
              ccoonnff__oolldd__mmddssuumm__ffiillee..

       ----tthhrreeee--wwaayy
              This turns on the option, during installation, for the  user  to
              be  offered  a  chance to see a merge of the changes between old
              maintainer version and the new maintainer version into the local
              copy of the configuration file. If the user likes what they see,
              they can ask to have these changes merged in. This allows one to
              get  new  upstream  changes merged in even while retaining local
              modifications to the configuration file. This is accomplished by
              taking  the  configuration  file and stashing it in a cache area
              during registration, and using diff3  during  the  install  (the
              stashed  file  name  is a munged version of the full path of the
              configuration file to avoid  name  space  clashes).   _N_o_t_e  This
              option  appeared in Version 0.8 of uuccff,, which was the first ver-
              sion released into unstable and ultimately SSaarrggee..   The  version
              of ucf in woody does not contain this option.

       ----ddeebbccoonnff--ookk
              Indicate that it is ok for _u_c_f to use an already running debconf
              instance for prompting (it has always been ok to  use  ucf  when
              debconf  is  not  running -- it shall invoke debconf as needed).
              Since historically maintainer scripts that used debconf and also
              ucf had to disable/cripple debconf before running ucf (since ucf
              did not prompt with debconf, and needed  stdio  available),  ucf
              must  be cautious when called from a maintainer script that uses
              debconf. This option lets it know that the maintainer script has
              not  told debconf to stop, or redirected its stdio from debconf,
              or anything of the sort -- and thus it is safe  to  use  debconf
              even  when  the script discovers that debconf is running.  Pack-
              ages that call ucf with this option should take care  to  depend
              on  version 0.28 or higher of ucf (the first to support use this
              option).

       ----ddeebbccoonnff--tteemmppllaattee  ffoooo
              Instruct ucf to  use  the  named  multiselect  debconf  template
              instead of the normal ucf-provided debconf template.  The caller
              is responsible for ensuring that the named template  exists  and
              has  a  list  of choices matching those for the default ucf tem-
              plate, and  should  set  Choices-C:  ${CHOICES}  to  ensure  the
              returned  values  match  those  from the default template.  Note
              that the choices must be  different  according  to  whether  the
              ----tthhrreeee--wwaayy option is also set.

       ----ssttaattee--ddiirr //ppaatthh//ttoo//ddiirr
              Set  the  state directory to /path/to/dir instead of the default
              _/_v_a_r_/_l_i_b_/_u_c_f_.  Used mostly for testing.

UUSSAAGGEE
       The most common case usage is pretty simple: a single  line  invocation
       in  the postinst on configure, and another single line in the postrm to
       tell uuccff to forget about the configuration file  on  purge  (using  the
       --purge  option)  is  all  that is needed (assuming ucf is still on the
       system).

       It is recommended that you also register any file being managed by  uuccff
       with  the ucf registry; this associates the configuration file with the
       package it belongs to. This is done with a simple call to uuccffrr..   Users
       may  then  query  the  association between a configuration file and the
       package using the tool uuccffqq..  Please see the appropriate  manual  pages
       for details.

       If  a  file maintained by maintainer scripts is being transitioned from
       an unprotected status to the protection afforded  by  the  script,  the
       maintainer  can help ease the transition by reducing the questions that
       may be asked at installation time. Specifically, questions  should  not
       be  asked if the file in question is an unmodified version that was one
       shipped in a previous version of this package; and the  maintainer  can
       help  by telling the script about the historical md5sums that published
       versions of this file contained.

       The way to do this is to either create a file called <<NNeeww ffiillee>>..mmdd55ssuumm,,
       with  one  md5sum  on  each  line, (the file names you use are ignored,
       except for the entry named default), or create a directory, called <<NNeeww
       ffiillee>>..mmdd55ssuumm..dd,, which should contain any number of files, each contain-
       ing a single line, namely, the md5sum of a  previous  version  of  <<NNeeww
       ffiillee>>..  The names of these files are not important, with one exception:
       The file called default is treated specially.  For example, the  author
       personally  uses  either package version numbers or release code names,
       like _7_._6_._3_, or _p_o_t_a_t_o_.  If none of the historical md5sums match, we are
       almost certain that either the historical record of md5sums is not com-
       plete, or the user has changed the configuration file.

   TThhee ddeeffaauulltt hhiissttoorriiccaall mmdd55ssuumm
       The exception to the rule about names mentioned earlier is that  if  no
       md5sums  match,  and if the file <<NNeeww ffiillee>>..mmdd55ssuumm..dd//ddeeffaauulltt exists, or
       if  there  is  a  line  corresponding  to  a  _d_e_f_a_u_l_t  file   in   <<NNeeww
       ffiillee>>..mmdd55ssuumm,,  it  shall  be used as the default md5sum of the _p_r_e_v_i_o_u_s
       version of the package assumed to have been installed on this  machine.
       As  you can see, unless there are limited number of previously released
       packages (like just one), the maintainer is  also  making  an  informed
       guess, but the option is provided to the maintainer.

       If  the  file  <<NNeeww  ffiillee>>..mmdd55ssuumm,, or the directory <<NNeeww ffiillee>>..mmdd55ssuumm..dd
       does not exist, or none of the md5sums match,  we  test  the  installed
       _<_D_e_s_t_i_n_a_t_i_o_n_> file to see whether it is the same as the _<_N_e_w _f_i_l_e_>_.  If
       not, we ask the user whether they want us to replace the file.

       An additional facility is also offered: optionally, ucf can  store  one
       old  version of the maintainers copy of the configuration file, and, on
       upgrade, calculate the changes made in the maintainers version  of  the
       configuration  file,  and  apply that patch to the local version of the
       file (on user request, of course). There is  also  a  preview  facility
       where  the  user can inspect the results of such a merge, before asking
       the action to be taken.

EENNVVIIRROONNMMEENNTT VVAARRIIAABBLLEESS
       The variable UUCCFF__FFOORRCCEE__CCOONNFFFFNNEEWW,, if set, forces the new file to  always
       overwrite   the   installed   destination   file,  while  the  variable
       UUCCFF__FFOORRCCEE__CCOONNFFFFOOLLDD,,  if  set  silently  retains  the  installed   file.
       UUCCFF__FFOORRCCEE__CCOONNFFFFMMIISSSS  is  only applicable when the installed destination
       file does not exist (perhaps due to user  removal),and  forces  ucf  to
       recreate  the missing file (the default behaviour is to honor the users
       wishes and not recreate the locally deleted file).

FFIILLEESS
       This script creates the file _n_e_w___f_i_l_e_._m_d_5_s_u_m_, and it may copy the  file
       (presumably  shipped  with  the package) _<_N_e_w _f_i_l_e_> to its destination,
       _<_D_e_s_t_i_n_a_t_i_o_n_>_.

       _/_v_a_r_/_l_i_b_/_u_c_f_/_h_a_s_h_f_i_l_e_, and _/_v_a_r_/_l_i_b_/_u_c_f_/_h_a_s_h_f_i_l_e_._X_, where _X is a  small
       integer, where previous versions of the hashfile are stored.

       _/_e_t_c_/_u_c_f_._c_o_n_f

EEXXAAMMPPLLEESS
       If the package _f_o_o wants to use ucf to handle user interaction for con-
       figuration file _f_o_o_._c_o_n_f_, a version of which is provided in the package
       as _/_u_s_r_/_s_h_a_r_e_/_f_o_o_/_c_o_n_f_i_g_u_r_a_t_i_o_n_, a simple invocation of ucf in the post
       inst file is all that is needed:

       uuccff _/_u_s_r_/_s_h_a_r_e_/_f_o_o_/_c_o_n_f_i_g_u_r_a_t_i_o_n _/_e_t_c_/_f_o_o_._c_o_n_f

       On purge, one should tell ucf to forget about the  file  (see  detailed
       examples in /usr/share/doc/ucf/examples):

       uuccff _-_-_p_u_r_g_e _/_e_t_c_/_f_o_o_._c_o_n_f

       The  motivation  for  this script was to provide conffile like handling
       for   start   files   for   emacs   lisp   packages    (for    example,
       _/_e_t_c_/_e_m_a_c_s_2_1_/_s_i_t_e_-_s_t_a_r_t_._d_/_5_0_p_s_g_m_l_-_i_n_i_t_._e_l  )  These start files are not
       shipped with the package, instead, they are installed during  the  post
       installation  configuration  phase  by the script _/_u_s_r_/_l_i_b_/_e_m_a_c_s_e_n_-_c_o_m_-
       _m_o_n_/_e_m_a_c_s_-_p_a_c_k_a_g_e_-_i_n_s_t_a_l_l _$_p_a_c_k_a_g_e___n_a_m_e_.

       This script is meant to be invoked by the packages  install  script  at
       _/_u_s_r_/_l_i_b_/_e_m_a_c_s_e_n_-_c_o_m_m_o_n_/_p_a_c_k_a_g_e_s_/_i_n_s_t_a_l_l_/_$_p_a_c_k_a_g_e___n_a_m_e for each flavour
       of installed emacsen by calling it with the proper values of new file (
       _/_u_s_r_/_s_h_a_r_e_/_e_m_a_c_s_/_s_i_t_e_-_l_i_s_p_/_<_p_k_g_>_/_<_p_k_g_-_i_n_i_t_._e_l   ),   and  dest  file  (
       _/_e_t_c_/_e_m_a_c_s_2_1_/_s_i_t_e_-_s_t_a_r_t_._d_/_5_0_<_p_k_g_-_i_n_i_t_._e_l ), and it should do the rest.

SSEEEE AALLSSOO
       ucf.conf(5), ucfr(1), ucfq(1), and diff3(1).  The DDeebbiiaann Emacs  policy,
       shipped with the package _e_m_a_c_s_e_n_-_c_o_m_m_o_n_.

AAUUTTHHOORR
       This  manual  page  was written Manoj Srivastava <srivasta@debian.org>,
       for the Debian GNU/Linux system.



Debian                            May 30 2008                           UCF(1)
